---
import Layout from '../../layouts/Layout.astro'
import { sanity } from '../../lib/sanity'

export async function getStaticPaths() {
    const slugs = await sanity.fetch(`
    *[_type == "event" && defined(slug.current)]{
      "slug": slug.current
    }
  `)

    return slugs.map(({ slug }) => ({
        params: { slug }
    }))
}

const { slug } = Astro.params

const event = await sanity.fetch(
    `*[_type == "event" && slug.current == $slug][0]`,
    { slug }
)
---

<Layout>
<h1>{event.title}</h1>
<p>{new Date(event.startDate).toLocaleString()}</p>
{event.location && <p>{event.location}</p>}
</Layout>
